<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Menu Votaci√≥n</title>
	</head>
	<body>
		<div id=content></div>
	</body>

	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript">
		var serviceURL = document.URL;
		console.log(serviceURL);
		var socket = io.connect('http://localhost:8081');
		
		function enviar(indPreg) {
			console.log();
			var indAlt = document.getElementById("preg"+indPreg).selectedIndex;
			socket.emit('add-vote', {preg: indPreg, alt: indAlt});
			
			// Desactivamos para que no pueda volver a pulsar (esto se debe controlar mejor cuando
			// se incluyan los usuarios).

			document.getElementById("form-preg-"+indPreg).style.display = 'none';
		}

		socket.on('initialize-values', function(data){
			var numPreg = data.data.preguntas.length;
			var numAlter = 0;

			var str="";

			for (var i=0; i<numPreg; i++){
				numAlter = data.data.preguntas[i].alternativas.length;
				console.log(numAlter);

				str += "<form id=\"form-preg-" + i + "\" action=\"javascript:void(0);\" onsubmit=\"javascript:enviar("+i+");\">";
				str += data.data.preguntas[i].contenido+"<br/>";
				str +="<select id=\"preg"+i+"\">";

				for (var j=0; j<numAlter; j++){
					str += "<option>"+data.data.preguntas[i].alternativas[j]+"</option>";
				}
				str+="</select>";
				str+="<input type=\"submit\" value=\"Votar\">";
				str+="</form>";
			}

			document.getElementById('content').innerHTML = str;
		});
	</script>
</html>
